<!DOCTYPE HTML>
<html lang="en">
    <head>
        <title>WebGL Globe</title>
        <meta charset="utf-8">
        <style type="text/css">
         html {
             height: 100%;
         }
         body {
             margin: 0;
             padding: 0;
             background: #000000 url(loading.gif) center center no-repeat;
             color: #ffffff;
             font-family: sans-serif;
             font-size: 13px;
             line-height: 20px;
             height: 100%;
         }
        </style>
    </head>
    <body>

        <div id="container"></div>

        <script type="text/javascript" src="third-party/Three/ThreeWebGL.js"></script>
        <script type="text/javascript" src="third-party/Three/ThreeExtras.js"></script>
        <script type="text/javascript" src="third-party/Three/RequestAnimationFrame.js"></script>
        <script type="text/javascript" src="third-party/Three/Detector.js"></script>
        <script type="text/javascript" src="third-party/Tween.js"></script>
        <script type="text/javascript" src="globe.js"></script>
        <script type="text/javascript">

         if(!Detector.webgl){
             Detector.addGetWebGLMessage();
         } else {

             var container = document.getElementById('container');
             var globe = new DAT.Globe(container);
             console.log(globe);
             


             xhr = new XMLHttpRequest();
             xhr.open('POST', 'https://purpledelivery.com/dashboard/orders-since-date', true);
             xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
             var params = "date=2016-01-17";
             xhr.setRequestHeader("Content-length", params.length);
             xhr.setRequestHeader("Connection", "close");
             xhr.onreadystatechange = function(e) {
                 if (xhr.readyState === 4) {
                     if (xhr.status === 200) {
                         var data = JSON.parse(xhr.responseText);
                         window.data = data;
                         var orders = data['orders'];
                         var ordersData = new Array();
                         for (i=0;i<orders.length && i<50000;i++) {
                             if (orders[i]['lat'] != 0) {
                                 ordersData.push(orders[i]['lat']);
                                 ordersData.push(orders[i]['lng']);
                                 //ordersData.push(orders[i]['gallons'] / 40);
                                 ordersData.push(Math.random()*0.85);
                             }
                             // globe.addData(data[i][1], {format: 'magnitude', name: data[i][0], animated: true});
                         }
                         globe.addData(
                             ordersData,
                             {
                                 format: 'magnitude'
                             }
                         );
                         globe.createPoints();
                         globe.animate();
                     }
                 }
             };
             xhr.send(params);
         }

        </script>

    </body>

</html>
